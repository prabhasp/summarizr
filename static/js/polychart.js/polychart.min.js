/*
GNU GENERAL PUBLIC LICENSE
   Version 3, 29 June 2007
 */var gg=function(){var a=a||{},b=b||{},c=c||{log:function(){},assert:function(){}};(function(a,b){b.makeClass=function(a,c){var d={},e=function(a,b){if(!(this instanceof e))return new e(d,arguments);typeof this.init=="function"&&this.init.apply(this,a===d?b:arguments)};return arguments.length>=2&&(e.prototype=new c,e.prototype.constructor=e,e._super=c.prototype),b.undef(a)||(e.prototype._cls_name=a),e},b.notImplemented=function(){throw"Not implemented."},b.undef=function(a){return typeof a=="undefined"},b.constfunc=function(a){return function(){return a}},b.invertedIndex=function(a){var b={};return _.each(a,function(a,c){b[a]=c}),b},b.translate=function(a,b){return c.assert(typeof a=="number","xpos is number"),c.assert(typeof b=="number","ypos is number"),"translate("+a+","+b+")"},b.matrix=function(a,b,c,d,e,f){return"matrix("+[a,b,c,d,e,f].join(",")+")"},b.identity=function(a){return a},b.cloneobj=function(a){var b=_.clone(a);return b.constructor=a.constructor,b},b.postfix=function(a,b){var c={0:"",3:"k",6:"m",9:"b",12:"t"};return _.isUndefined(c[b])?a+"x10^"+b:a+c[b]},b.prettify=function(a,c){arguments.length==1&&(c=-Math.floor(Math.log(Math.abs(a))/Math.LN10-1),a>0&&a<10&&(c=0));var d=c;c%3==1?d-=1:c%3==2?d-=2:c%3==-1?d+=1:c%3==-2&&(d+=2);var e=Math.max(c,d),f=Math.round(a*Math.pow(10,e))/Math.pow(10,e-d);return b.postfix(f.toFixed(e-d),-d)},b.roundTo=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},b.array=function(a,b){var c=[],d=a,e,f=_.isFunction(b);while(d--)f?e=b():e=b,c[d]=e;return c},b.grid=function(a,b,c){var d=0,e=0,f=[],g=_.isFunction(c);for(d=0;d<a;d++){var h=[];for(e=0;e<b;e++)g?h.push(c()):h.push(c);f.push(h)}return f},b.opts=function(){var a=function(a,b){var d=this,e=this._optsUpdate;_.isFunction(e)?e=_.bind(e,this):e=function(){};if(arguments.length==1){if(!_.isString(a)&&_.keys(a).length>0)return _.each(a,function(a,b){d._attr[b]=a,e(b,a)}),this;var f=this._attr[a];return f}return c.assert(_.isString(a)),this._attr[a]=b,e(a,b),this};return a},b.dataGetter=function(){var b=function(b){if(arguments.length===0)return this._data;if(!b||b._cls_name!="gg.data")b=a.data(b);return this._data=b,this};return b},b.calculateFacet=function(c,d){if(!d)return[c];var e=d.nrow(),f=d.ncol(),g=function(){return a.data([],c.keys())},h=b.array(e*f,g),i,j=c.len();for(i=0;i<j;i++){var k=c.getObject(i),l=d.bin(k);h[l].push(k)}return h},b.doubleMap=function(a,b){return _.map(a,function(a){return _.map(a,b)})},b.tripleMap=function(a,b){return _.map(a,function(a){return _.map(a,function(a){return _.map(a,b)})})};var d=[];b.concat=function(a){return d.concat.apply(d,a)},b.add=function(a,b){var c=_.isFunction(a),d=_.isFunction(b);return c&&d?function(c){return a(c)+b(c)}:c?function(c){return a(c)+b}:d?function(c){return a+b(c)}:a+b},b.sub=function(a,b){var c=_.isFunction(a),d=_.isFunction(b);return c&&d?function(c){return a(c)-b(c)}:c?function(c){return a(c)-b}:d?function(c){return a-b(c)}:a-b},b.evaluate=function(a,b){return _.isFunction(a)?a(b):a},b.unionType=function(a){if(a.length==1)return a[0];var b=_.uniq(a);return b.length==1?a[0]:"discrete"},b.bool=function(a){return a?!0:!1},b.startswith=function(a,b){if(!_.isString(b)||!_.isString(a))return!1;var c=b.length,d=a.length;return c>d?!1:a.slice(0,c)===b},b.normalizeDom=function(a){return _.isString(a)?d3.select(a):a.jquery?d3.select(a[0]):a.nodeType?d3.select(a):a},b.instantiate=function(b){return _.isString(b)?a[b]():b&&b.prototype&&b.prototype._cls_name?b():b},b.isURL=function(a){var b=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return _.isString(a)&&b.test(a)}})(a,b),function(a){a.graph=b.makeClass("gg.graph"),a.graph.prototype.init=function(a){this._data=null,this.data(a),this._layers=[],this._scales={},this._coord=null,this._facet=null,this._attr={width:300,height:300,"padding-left":50,"padding-right":50,"padding-top":50,"padding-bottom":50,"legend-position":"right","legend-width":60,"legend-height":30,"spacing-x":20,"spacing-y":40,"facet-x":20,title:"","title-size":15,"title-bold":!0,"label-size":12,"label-bold":!1,"axis-y":"left","axis-y-line":null,"axis-y-label":null,"axis-y-ticks":null,"axis-y-ticklength":null,"axis-y-color":null,"axis-y-strokewidth":null,"axis-y-":null,"axis-x":"bottom","axis-x-line":null,"axis-x-label":null,"axis-x-ticks":null,"axis-x-ticklength":null,"axis-x-color":null,"axis-x-strokewidth":null,"grid-render-vertical":null,"grid-render-horizontal":null,"grid-stroke":null,"grid-strokewidth":null,"grid-dasharray":null,dom:null},this._doms={},this._dimCache=null,this._rendered=!1},a.graph.prototype.data=b.dataGetter(),a.graph.prototype._varlabel=function(a){var c=this.opts("label-"+a);return b.undef(c)?_.chain(this._layers).map(function(b){return b.map(a)}).filter(b.identity).value()[0]:c};var d=function(a){a._layers||c.log("_checkLayer being called without _layer")};a.graph.prototype.type=function(a,c){d(this);var e=_.invoke(this._layers,"type",a,c);return b.unionType(e)},a.graph.prototype.min=function(a,b){d(this);var c=_.invoke(this._layers,"min",a,b);return _.min(c)},a.graph.prototype.max=function(a,b){d(this);var c=_.invoke(this._layers,"max",a,b);return _.max(c)},a.graph.prototype.levels=function(a,b){d(this);var c=_.invoke(this._layers,"levels",a,b);return _.uniq(_.flatten(c))},a.graph.prototype.defaultMin=function(a){if(this._layers.length===0)return null;var b=_.chain(this._layers).invoke("defaultMin",a).filter(_.isNumber).min().value();return b!=Infinity?b:null},a.graph.prototype.defaultMax=function(a){if(this._layers.length===0)return null;var b=_.chain(this._layers).invoke("defaultMax",a).filter(_.isNumber).max().value();return b!=-Infinity?b:null},a.graph.prototype.dataLevels=function(a){var b=function(b){return b.data().levels(a)};return _.chain(this._layers).map(b).flatten().uniq().value()},a.graph.prototype.opts=b.opts(),a.graph.prototype._optsUpdate=function(a,b){this._rendered&&(a=="title"?this._update_label("_debug_title",b):a=="label-x"?this._update_label("_debug_x_label",b):a=="label-y"&&this._update_label("_debug_y_label",b))},a.graph.prototype.layer=function(a){a=b.instantiate(a),c.assert(a,"newlayer must be passed in."),c.assert(a._detached,"cannot attach already attached object.");var d=b.cloneobj(a);return d.attach(this),this._layers.push(d),this},a.graph.prototype.scale=function(a,d){c.assert(a,"key must be passed in."),c.assert(d,"scale must be passed in."),d=b.instantiate(d);var e=b.cloneobj(d);return e.attach(this,a),this._scales[a]=e,this},a.graph.prototype.coord=function(a){if(arguments.length===0)return this._coord;a=b.instantiate(a);var c=null;return c=b.cloneobj(a),c.attach(this),this._coord=c,this},a.graph.prototype.facet=function(a){if(arguments.length===0)return this._facet;a=b.instantiate(a),c.assert(a,"facet must be passed in.");var d=b.cloneobj(a);return d.attach(this),this._facet=d,this},a.graph.prototype.render_label=function(a,c,d,e,f){var g=this._doms[f],h=null;return g?h=g:(h=this.plot.append("svg:g").attr("class",f),this._doms[f]=h),h.attr("transform",b.translate(d,e)).append("text").attr("text-anchor","middle").text(c)},a.graph.prototype.render_title=function(a,b,c){this.render_label(a,this.opts("title"),b,c,"_debug_title").style("font-weight",this.opts("title-bold")?"bold":"normal").style("font-size",this.opts("title-size"))},a.graph.prototype.render_x_label=function(a,b,c){this.render_label(a,this._varlabel("x"),b,c,"_debug_x_label").style("font-weight",this.opts("label-bold")?"bold":"normal").style("font-size",this.opts("label-size"))},a.graph.prototype.render_y_label=function(a,b,c){this.render_label(a,this._varlabel("y"),b,c,"_debug_y_label").attr("transform","rotate(-90 0 0)").style("font-weight",this.opts("label-bold")?"bold":"normal").style("font-size",this.opts("label-size"))},a.graph.prototype._update_label=function(a,b){this._doms[a].select("text").text(b)},a.graph.prototype._calculateDims=function(){var a=_.keys(this._scales).length-2,b=this.opts("width")-this.opts("padding-left")-this.opts("padding-right"),d=this.opts("height")-this.opts("padding-top")-this.opts("padding-bottom");c.assert(_.isNumber(b)),c.assert(_.isNumber(d));var e=this._facet?this._facet.ncol():1,f=this._facet?this._facet.nrow():1,g=e==1?0:this.opts("spacing-x"),h=f==1?0:this.opts("spacing-y"),i={ncol:e,nrow:f,chartWidth:b,chartHeight:d,eachWidth:(b-(e-1)*g)/e,eachHeight:(d-f*h)/f,spacingX:g,spacingY:h,additionalScales:a};return this._dimCache=i,i},a.graph.prototype._renderAxis=function(c,d,e,f){var g=null,h=null,i=null,j=this,k=this.plot.append("svg:g").attr("class","axis"),l=this.coord()._flip!==(this.coord()._cls_name==="gg.coord.polar"),m=l?this._scales.y:this._scales.x,n=l?this._scales.x:this._scales.y,o=a.guide.axis(m,"x"),p=this.coord()._cls_name==="gg.coord.polar"?a.guide.axis(n,"y",null,!0):a.guide.axis(n,"y");_.each(this._attr,function(a,b){var c=b.substr(0,7);c=="axis-x-"&&!_.isNull(a)?o.opts(b.substr(7),a):c=="axis-y-"&&!_.isNull(a)?p.opts(b.substr(7),a):c.substr(0,5)=="axis-"&&(o.opts(b.substr(5),a),p.opts(b.substr(5),a))});var q=function(a,c,d){var g=j.xposition(c),h=j.yposition(a);return d=="right"?g+=e:d=="bottom"?h+=f:d=="center"&&(g+=e/2,h+=f/2),k.append("svg:g").attr("class","_axis_"+d).attr("transform",b.translate(g-.5,h-.5))};for(g=0;g<c;g++)for(h=0;h<d;h++)i=this.opts("axis-y"),(i=="left"&&h==0||i=="right"&&h==d-1)&&p.renderLinear(q(g,h,i),i),i=this.opts("axis-x"),i!="none"&&(this.coord()._cls_name==="gg.coord.polar"?o.renderCircular(q(g,h,"circular"),"circular"):i=="bottom"&&g==c-1||i=="top"&&g==0?o.renderLinear(q(g,h,i),i):o.renderLinear(q(g,h,i),i,{ticks:!1,labels:!1}))},a.graph.prototype._renderGrid=function(c,d){var e=this.plot.append("svg:g").attr("class","axis"),f=a.guide.grid(this._scales.x,this._scales.y,this._coord);this.coord()._cls_name==="gg.coord.polar"&&f.opts("render-vertical",!0),_.each(this._attr,function(a,b){b.substr(0,5)=="grid-"&&!_.isNull(a)&&f.opts(b.substr(5),a)});for(var g=0;g<c;g++)for(var h=0;h<d;h++){var i=this.plot.append("svg:g").attr("class","_debug_grid").attr("transform",b.translate(this.xposition(h),this.yposition(g)-.5));f.render(i)}},a.graph.prototype.makeplot=function(a){return _.isUndefined(a)?a=d3.select(this.opts("dom")):a=b.normalizeDom(a),a.selectAll("svg").remove(),a.append("svg:svg").attr("width",this.opts("width")).attr("height",this.opts("height"))},a.graph.prototype.setDefaultScales=function(){var b=_.chain(this._layers).map(function(a){return _.keys(a.getMap())}).flatten().uniq().without(_.keys(this._scales),"group").value(),c=this._scales,d=this;return _.each(b,function(b){var c=d.type(b),e=null;b=="x"||b=="y"?e=c=="continuous"?a.scale.continuous():a.scale.discrete():b=="color"||b=="stroke"?e=c=="continuous"?a.scale.gradient():a.scale.palette():b=="symbol"?e=a.scale.symbol():e=a.scale.id(),d.scale(b,e)}),this},a.graph.prototype.bindDerivedScales=function(){var a=this._scales;_.each(a,function(b,c){if(c.indexOf("_")>-1){var d=c.split("_",1),e=d[0];a[c]=a[e]}})},a.graph.prototype.setDefaultCoord=function(){return this._coord||this.coord(a.coord.cart()),c.assert(this._coord,"Coordinates must be set."),this},a.graph.prototype._clearCache=function(){this._doms={},this._dimCache=null},a.graph.prototype._preRender=function(){this._debugStartTime=new Date,this._clearCache(),this._rendered=!1},a.graph.prototype._postRender=function(){var a=new Date,b=a-this._debugStartTime;this._rendered=!0,c.log("render() took",b," ms.")},a.graph.prototype.xposition=function(a){var b=this._dimCache;return c.assert(b,"_dimCache is required."),this.opts("padding-left")+a*(b.eachWidth+b.spacingX)},a.graph.prototype.yposition=function(a){var b=this._dimCache;return c.assert(b,"_dimCache is required."),this.opts("padding-top")+a*(b.eachHeight+b.spacingY)+b.spacingY},a.graph.prototype.renderLayer=function(a,c,d,e){var f=this._calculateDims(),g=f.eachWidth,h=f.eachHeight,i=this.plot.append("svg:g").attr("class","_debug_layer").attr("transform",b.translate(c,d)),j={cell:i,rawScales:this._scales,coord:this._coord,facetIndex:e};a.renderEntry(j)},a.graph.prototype.render=function(d){this._preRender();var e=this,f=this._scales,g=this._facet;_.invoke(this._layers,"_dataChanged"),_.invoke(this._layers,"calculate"),this.plot=this.makeplot(d),this.setDefaultScales().setDefaultCoord(),this.bindDerivedScales(),c.assert(f.x,"scales.x is required"),c.assert(f.y,"scales.y is required");var h=this._calculateDims(),i=h.ncol,j=h.nrow,k=h.chartWidth,l=h.chartHeight,m=h.eachWidth,n=h.eachHeight,o=h.spacingX,p=h.spacingY,q=h.additionalScales;this._coord.configScale({x:0,y:0,width:m,height:n},f),_.each(f,function(a,b){a.make()}),this._renderGrid(j,i);var r=0;for(var s=0;s<j;s++)for(var t=0;t<i;t++){for(var v=0;v<this._layers.length;v++){var w=e._layers[v];this.renderLayer(w,this.xposition(t),this.yposition(s),r)}r++}this._renderAxis(j,i,m,n);if(j>1||i>1)for(var s=0;s<j;s++)for(var t=0;t<i;t++){var x=this.plot.append("svg:g").attr("class","_debug_facet_label").attr("transform",b.translate(this.xposition(t)+m/2,this.yposition(s)-p*.1));this._facet.renderLabel(x,s,t)}this._coord._name!=="polar"&&(this.render_y_label(this.plot,this.opts("padding-left")*.35,this.opts("padding-top")+l/2),this.render_x_label(this.plot,this.opts("padding-left")+k/2,this.opts("padding-top")+l+35)),this.render_title(this.plot,this.opts("width")/2,this.opts("padding-top")*.7);if(this.opts("legend-position")!="none"){var y=this.opts("padding-left")+k+10,z=this.opts("padding-top"),x=this.plot.append("svg:g").attr("class","_debug_legends").attr("transform",b.translate(y,z));a.guide.legend(this,this._layers,this._scales).render(x)}return this._postRender(),this}}(a),function(a){a.coord=a.coord||{},a.coord.base=b.makeClass("gg.coord.base"),a.coord.base.prototype.init=function(){this._graph=null,this._detached=!0},a.coord.base.prototype.attach=function(a){return c.assert(this._detached),this._detached=!1,this._graph=a,this},a.coord.base.prototype.set=function(a,b){return this.attr[a]=b,this},a.coord.base.prototype.configScale=function(a,c){b.notImplemented()},a.coord.base.prototype.transX=function(a,c){b.notImplemented()},a.coord.base.prototype.transY=function(a,c){b.notImplemented()},a.coord.base.prototype.drawAxis=function(a,c){b.notImplemented()},a.coord.base.prototype.line=function(){b.notImplemented()},a.coord.base.prototype.vline=function(){b.notImplemented()},a.coord.base.prototype.hline=function(){b.notImplemented()},a.coord.base.prototype.rect=function(){b.notImplemented()},a.coord.base.prototype.point=function(){b.notImplemented()},a.coord.base.prototype.poly=function(){b.notImplemented()},a.coord.base.prototype.text=function(){return a.coord.AbstractShape(this,function(a){var b=a.enter().append("svg:text");this.attachAttr(a)})};var d=function(a,b,c){var d=a.length,e=0,f=[];for(e=0;e<d;e++)f.push(c(a[e],b[e]));return f};a.coord.DataFunc=function(a){var b=a._attrs.sort;return function(c){var d;b?d=_.sortBy(c.rawObjects(),b):d=c.rawObjects();var e=_.map(d,a._attrs.x),f=_.map(d,a._attrs.y);return[e,f]}},a.coord.LineFunc=function(a){var b=a._attrs;return function(a){var c=function(b){return _.isFunction(b)?b(a):b},d,e,f,g;b.x?d=e=b.x:(d=b.x1,e=b.x2),b.y?f=g=b.y:(f=b.y1,g=b.y2);var h=_.map([d,e],c),i=_.map([f,g],c);return[h,i]}},a.coord.RectFunc=function(a){var b=a._attrs;return function(a){var c=function(b){return _.isFunction(b)?b(a):b},d=b.x1,e=b.x2,f=b.y1,g=b.y2,h=_.map([d,d,e,e],c),i=_.map([f,g,g,f],c);return[h,i]}},a.coord.base.prototype.points=function(a,b){var e=a._attrs,f=e.postprocess,g=_.bind(this.transX,this),h=_.bind(this.transY,this);return function(a){var e,i,j=b(a),k=j[0],l=j[1];i=k.length,_.isFunction(f)&&f(k,l);var m=d(k,l,g),n=d(k,l,h),o=[];c.assert(m.length===n.length);var p=m.length;for(var q=0;q<p;q++)o.push(m[q]),o.push(n[q]);return o.join(" ")}},a.coord.AbstractShape=function(a,b){c.assert(b,"callback is required."),c.assert(a,"coord is required.");var d=function(a){return b.call(d,a)};return d._attrs={},d.attr=function(a,b){return this._attrs[a]=b,this},d.attachAttr=function(a,b,c){return _.each(this._attrs,function(c,d){_.indexOf(b,d)===-1&&(d==="text"?a.text(c):a.attr(d,c))}),_.each(c,function(b,c){a.attr(c,b)}),a.on("mouseover",function(a,b){var c=d3.select(this),d=c.attr("fill");d!="none"?(a._gg_oldfill=d,c.attr("fill",d3.rgb(d).darker().toString())):c.attr("stroke-width")>0&&(a._gg_oldstroke=c.attr("stroke"),c.attr("stroke",d3.rgb(a._gg_oldstroke).darker().toString())),c.style("cursor","pointer"),c.style("cursor","hand")}),a.on("mouseout",function(a,b){var c=d3.select(this),d=c.attr("fill");d!="none"?c.attr("fill",a._gg_oldfill):c.attr("stroke-width")>0&&c.attr("stroke",a._gg_oldstroke),c.style("cursor","normal")}),this},d.style=function(a){return this.attr("stroke",a.stroke).attr("stroke-width",a.strokewidth).attr("fill-opacity",a.opacity).attr("fill",a.color),this},d}}(a),function(a){a.facet=a.facet||{},a.facet.base=b.makeClass("gg.facet.base"),a.facet.base.prototype.init=function(){this._graph=null,this._detached=!0,this._attr={}},a.facet.base.prototype.attach=function(a){c.assert(this._detached,"already attached."),this._graph=a,this._detached=!1},a.facet.base.prototype.attr=function(a,b){return arguments.length===1?this._attr[a]:(this._attr[a]=b,this)},a.facet.base.bin=function(a){throw"Not implemented"},a.facet.base.prototype.ncol=function(){throw"Not implemented!"},a.facet.base.prototype.nrow=function(){throw"Not implemented!"},a.facet.base.prototype.renderLabel=function(a,b,c){throw"Not implemented!"}}(a),function(a){a.guide=a.guide||{},a.guide.base=b.makeClass("gg.guide.base"),a.guide.base.prototype.init=function(){this._attr={num_ticks:5}},a.guide.base.prototype.opts=b.opts()}(a),function(a){a.layer=a.layer||{},a.layer.base=b.makeClass("gg.layer.base");var d=function(a,b){this.name=a,this.defaultMapping=b?!0:!1};a.layer.base.prototype.init=function(b){this._attr={color:"steelblue",opacity:.9,stroke:"#FFFFFF",strokewidth:0,facet:!0},this._graph=null,this._data=null,this._facetedData=null,this._statData=null,this._stats=undefined,this._detached=!0,this._default_stats=a.stats.id,this._calculated=!1},a.layer.base.prototype.opts=b.opts(),a.layer.base.prototype.data=b.dataGetter(),a.layer.base.prototype.stats=function(b){if(arguments.length===1)return _.isString(b)&&(b=a.stats[b]()),this._stats=b,this._applyDefaultMappings(),this;if(_.isUndefined(this._stats)){var c=this._default_stats();this._stats=c}return this._stats},a.layer.base.prototype.attach=function(a){return c.assert(this._detached),this.data()||this.data(a.data()),this._detached=!1,this._graph=a,this},a.layer.base.prototype.defaultScales=function(){return{}},a.layer.base.prototype.defaultMin=function(a){return null},a.layer.base.prototype.defaultMax=function(a){return null},a.layer.base.prototype.requiredMap=function(){return null},a.layer.base.prototype.calculateStats=function(a){var b=this.getMap(),c=this.stats().group(a,b);return c},a.layer.base.prototype.calculate=function(){c.assert(!this._detached,"Layer must be attached before _calculate()");if(this._calculated)return;this._facetedData=b.calculateFacet(this._data,this._graph.facet());var a=_.bind(this.calculateStats,this);return this._statData=_.map(this._facetedData,a),this._calculated=!0,this},a.layer.base.prototype.map=function(a,b){c.assert(arguments.length>0);if(arguments.length===1){var e=this._attr[a];return e instanceof d?e.name:null}return this._attr[a]=new d(b),this},a.layer.base.prototype.getMap=function(){var a={};return _.each(this._attr,function(b,c){b instanceof d&&(a[c]=b.name)}),a},a.layer.base.prototype.getAestheticsGroup=function(a){var c=a+"_",d=this.getMap(),e={};return _.chain(d).keys().filter(function(d){return d==a||b.startswith(d,c)}).map(function(a){e[a]=d[a]}),e},a.layer.base.prototype.getData=function(a,b){if(!this._data)return null;var c=this.map(a);return c?this._data.get(c,b):null},a.layer.base.prototype.type=function(a){var b=this.map(a);return b?this._data.type(b):null},a.layer.base.prototype.getScales=function(a){var b={},c=this;return _.each(this._attr,function(c,e){if(c instanceof d){var f=a[e];f&&(b[e]=_.bind(f.apply,f,c.name),b[e]._debug_context=a[e])}else b[e]=c}),b},a.layer.base.prototype.renderEntry=function(a){this._checkMappings(),this.calculate(),a.computedData=this._statData[a.facetIndex],a.scales=this.getScales(a.rawScales),this.render(a)},a.layer.base.prototype.render=function(a){throw"Not implemented"};var e=[],f=0,g=1,h=2;a.layer.base.prototype.queryData=function(a,d,e,i){this.calculate();var j,k,l,m=this;if(d===h){k=_.values(this.getAestheticsGroup(a));var n=_.map(k,function(a){return b.doubleMap(m._statData,_.bind(e,null,a))});l=b.concat(n)}else d===g?j=a:d===f?j=this.map(a):c.assert(!1,"Should not reach here - invalid option."),l=b.doubleMap(m._statData,_.bind(e,null,j));var o=b.concat(l);return i(o)},a.layer.base.prototype.queryAllAesthetics=function(a,b,c,d){},a.layer.base.prototype.min=function(a,b){var c=function(a,b){return b.min(a)},d=_.min,e=b?g:h;return this.queryData(a,e,c,d)},a.layer.base.prototype.max=function(a,b){var c=function(a,b){return b.max(a)},d=_.max,e=b?g:h;return this.queryData(a,e,c,d)},a.layer.base.prototype.levels=function(a,c){var d=function(a,b){return b.levels(a)},e=function(a){return _.union(b.concat(a))},f=c?g:h;return this.queryData(a,f,d,e)},a.layer.base.prototype.type=function(a,b){var c=function(a,b){return b.type(a)},d=function(a){var b=_.uniq(a);return b.length===1?b[0]:"discrete"},e=b?g:h;return this.queryData(a,e,c,d)},a.layer.base.prototype._checkMappings=function(){var a=this.requiredMap();if(_.isArray(a)){var b=_.difference(a,_.keys(this.getMap()));if(b.length>0)throw"Not all the required mappings are present."}},a.layer.base.prototype.imputeMapping=function(a,b){var c=a?a.keys():[],d={},e=0;if(!_.has(b,"x")){while(e<c.length&&c[e]===b.y)e++;e<c.length&&(d.x=c[e])}if(!_.has(b,"y")){while(e<c.length&&(c[e]===b.x||c[e]===d.x))e++;e<c.length&&(d.y=c[e])}return _.has(b,"group")||(_.has(b,"x")&&(d.group=b.x),_.has(d,"x")&&(d.group=d.x)),d},a.layer.base.prototype._applyDefaultMappings=function(){var a=this,b=this._data,c=this.stats(),e=this.getMap(),f=this.imputeMapping(b,this.getMap()),g=c?c.imputeMapping(b,e):{},h=_.extend(f,g);h&&_.each(h,function(b,c){var e=a._attr[c];_.isUndefined(e)?a._attr[c]=new d(b,!0):e instanceof d&&e.defaultMapping&&(a._attr[c].value=b)})},a.layer.base.prototype._dataChanged=function(){this._applyDefaultMappings()}}(a),function(a){a.scale=a.scale||{},a.scale.base=b.makeClass("gg.scale.base"),a.scale.base.prototype.init=function(){this._aes=null,this._graph=null,this._detached=!0,this._range=null,this._type=null,this._min=null,this._max=null,this._absoluteMin=-Infinity,this._absoluteMax=Infinity,this._attr={pixel_per_tick:40,ticks:null,numticks:null}},a.scale.base.prototype.opts=b.opts(),a.scale.base.prototype.attach=function(a,b){c.assert(b),c.assert(a),c.assert(this._detached),this._aes=b,this._graph=a,this._detached=!1},a.scale.base.prototype.min=function(a){return arguments.length===1?(a<this._absoluteMin&&(c.log(a,"val is too low."),a=this._absoluteMin),this._min=a,this):this._min},a.scale.base.prototype.max=function(a){return arguments.length===1?(a>this._absoluteMax&&(c.log(a,"val is too high."),a=this._absoluteMax),this._max=a,this):this._max},a.scale.base.prototype.type=function(){return this._type},a.scale.base.prototype._saneNumber=function(a){return _.isNumber(a)&&!isNaN(a)&&a!=Infinity&&a!=-Infinity},a.scale.base.prototype._makeDomain=function(){var a=this._aes,b=this._graph.min(a),c=this._graph.defaultMin(a),d=this._graph.max(a),e=this._graph.defaultMax(a);return this._min=_.chain([b,this._min,c]).filter(_.isNumber).min().value(),this._max=_.chain([d,this._max,e]).filter(_.isNumber).max().value(),[this._min,this._max]},a.scale.base.prototype.domain=function(a){return arguments.length===1?(this._min=a[0],this._max=a[1],this):[this._min,this._max]},a.scale.base.prototype.range=function(a){return arguments.length?(this._range=a,this):this._range},a.scale.base.prototype.make=function(){b.notImplemented()},a.scale.base.prototype._apply=function(a){throw"Not implemented"},a.scale.base.prototype.apply=function(a,b){arguments.length==1&&(b=a,a=undefined),b._cls_name==="gg.data"&&(b=b.rawObject(0));var c=_.isUndefined(a)||_.isUndefined(b[a])?b:b[a];return this._apply(c)},a.scale.base.prototype._tickObject=function(a,b,c){return{data:a,label:c,pos:b}},a.scale.base.prototype._getNumticks=function(a){if(a)this.opts("numticks",a);else{a=this.opts("numticks");if(_.isNull(a)){var b=Math.abs(this._range[1]-this._range[0]);b==2*Math.PI?a=6:a=b/this.opts("pixel_per_tick"),this.opts("numticks",a)}}return a},a.scale.base.prototype.ticks=function(){b.notImplemented()}}(a),function(a){a.stats=a.stats||{},a.stats.base=b.makeClass("gg.stats.base"),a.stats.base.prototype.init=function(){},a.stats.base.prototype.checkMap=function(a){var b=this.requiredMap();if(b&&b.length>0){var d=_.intersect(_.keys(a),b);return d.length&&c.assert("Missing mappings:",d),d}return null},a.stats.base.prototype.imputeMapping=function(a,b){return null},a.stats.base.prototype.requiredMap=function(){return null},a.stats.base._groupImpl=function(b,d,e){c.assert(d);var f=_.isFunction(e),g=d,h=b.get(g),i=null;f?i=_.chain(h).uniq().map(e).uniq().value():i=_.uniq(h),i.sort();var j={},k=[],l=b.keys(),m=function(){var a={};return _.each(l,function(b){a[b]=[]}),a};_.each(i,function(a){j[a]=m()});for(var n=0;n<b.len();n++){var o=b.get(g,n);f&&(o=e(o));var p=j[o];_.each(l,function(a){var c=b.get(a,n);p[a].push(c)})}return _.each(i,function(b){var c=a.data(j[b]);k.push(c)}),k},a.stats.base.prototype.group=function(b,c,d){this.checkMap(c);var e=this,f=function(a){return e.compute(a,c)},g;if(_.has(c,"group")){var h=a.stats.base._groupImpl(b,c.group,d);g=_.map(h,f)}else g=[f(b)];return this.postProcess(g,c)},a.stats.base.prototype.compute=function(a,b){return a},a.stats.base.prototype.postProcess=function(a,b){return a}}(a),function(a){a.coord.cart=b.makeClass("gg.coord.cart",a.coord.base),a.coord.cart.prototype.init=function(c){a.coord.base.prototype.init.call(this),this._flip=b.bool(c)},a.coord.cart.prototype.configScale=function(a,b){this._flip?(b.x.range([a.y,a.height]),b.y.range([a.x,a.height])):(b.x.range([a.x,a.width]),b.y.range([a.height,a.y]))},a.coord.cart.prototype.transX=function(a,b){return this._flip?b:a},a.coord.cart.prototype.transY=function(a,b){return this._flip?a:b},a.coord.cart.prototype.line=function(){var b=this;return a.coord.AbstractShape(this,function(c){var d=c.enter().append("svg:polyline"),e=["x1","y1","x2","y2"],f=b.points(this,a.coord.LineFunc(this));this.attachAttr(c,e,{points:f})})},a.coord.cart.prototype.vline=function(){var b=this;return a.coord.AbstractShape(this,function(c){var d=c.enter().append("svg:polyline"),e=["x1","y1","x2","y2"],f=b.points(this,a.coord.LineFunc(this));this.attachAttr(c,e,{points:f})})},a.coord.cart.prototype.hline=function(){var b=this;return a.coord.AbstractShape(this,function(c){var d=c.enter().append("svg:polyline"),e=["x1","y1","x2","y2"],f=b.points(this,a.coord.LineFunc(this));this.attachAttr(c,e,{points:f})})},a.coord.cart.prototype.rect=function(){var b=this;return a.coord.AbstractShape(this,function(c){var d=c.enter().append("svg:polygon"),e=["x1","y1","x2","y2"],f=b.points(this,a.coord.RectFunc(this));this.attachAttr(c,e,{points:f})})},a.coord.cart.prototype.point=function(){return a.coord.AbstractShape(this,function(b){var c=this._attrs.symbol;a.symbol.appendSymbol(b.enter(),c);var d=["x","y","r"];this.attachAttr(b,d,a.symbol.makeAdditionalAttr(this))})},a.coord.cart.prototype.poly=function(b){var c=this;return a.coord.AbstractShape(this,function(d){var e=d.enter().append(b),f=["x","y","sort","postprocess"],g=c.points(this,a.coord.DataFunc(this));this.attachAttr(d,f,{points:g})})}}(a),function(a){a.coord.polar=b.makeClass("gg.coord.polar",a.coord.base),a.coord.polar.prototype.init=function(c){a.coord.base.prototype.init.call(this),this._originX=null,this._originY=null,this._flip=b.bool(c)},a.coord.polar.prototype.configScale=function(a,b){this._originX=(a.x+a.width)/2,this._originY=(a.y+a.height)/2;var c=1;this._flip?(b.y.range([0,Math.min(a.width,a.height)/2*c]),b.x.range([0,2*Math.PI])):(b.x.range([0,Math.min(a.width,a.height)/2*c]),b.y.range([0,2*Math.PI]))},a.coord.polar.prototype.transX=function(a,b){return this._flip?this._originX+b*Math.sin(a):this._originX+a*Math.sin(b)},a.coord.polar.prototype.transY=function(a,b){return this._flip?this._originY+b*Math.cos(a):this._originY+a*Math.cos(b)},a.coord.polar.prototype.line=function(){var b=this;return a.coord.AbstractShape(this,function(c){var d=c.enter().append("svg:polyline"),e=["x1","y1","x2","y2"],f=b.points(this,a.coord.LineFunc(this));this.attachAttr(c,e,{points:f})})},a.coord.polar.prototype.vline=function(){var c=this;return a.coord.AbstractShape(this,function(a){var d=a.enter().append("svg:path"),e=this._attrs,f=["x","y","x1","x2","y1","y2"],g=d3.svg.arc();c._flip?g.innerRadius(e.y1).outerRadius(e.y2).startAngle(e.x).endAngle(e.x):g.innerRadius(e.x).outerRadius(e.x).startAngle(e.y1).endAngle(e.y2),this.attachAttr(a,f,{d:g,transform:b.translate(c._originX,c._originY)})})},a.coord.polar.prototype.hline=function(){var c=this;return a.coord.AbstractShape(this,function(a){var d=a.enter().append("svg:path"),e=this._attrs,f=["x","y","x1","x2","y1","y2"],g=d3.svg.arc();c._flip?g.innerRadius(e.y).outerRadius(e.y).startAngle(e.x1).endAngle(e.x2):g.innerRadius(e.x1).outerRadius(e.x2).startAngle(e.y).endAngle(e.y),this.attachAttr(a,f,{d:g,transform:b.translate(c._originX,c._originY)})})},a.coord.polar.prototype.rect=function(){var c=this;return a.coord.AbstractShape(this,function(a){var d=a.enter().append("svg:path"),e=this._attrs,f=["x","y","x1","x2","y1","y2"],g=d3.svg.arc();c._flip?g.innerRadius(e.y1).outerRadius(e.y2).startAngle(e.x1).endAngle(e.x2):g.innerRadius(e.x1).outerRadius(e.x2).startAngle(e.y1).endAngle(e.y2),this.attachAttr(a,f,{d:g,transform:b.translate(c._originX,c._originY)})})},a.coord.polar.prototype.poly=function(b){var c=this;return a.coord.AbstractShape(this,function(a){var d=a.enter().append(b),e=["x","y","sort","postprocess","x1","x2","y1","y2"],f=c.points(this);this.attachAttr(a,e,{points:f})})},a.coord.polar.prototype.point=function(){return a.coord.AbstractShape(this,function(b){var c=this._attrs.symbol,d=["x","y","r"];a.symbol.appendSymbol(b.enter(),c),this.attachAttr(b,d,a.symbol.makeAdditionalAttr(this))})}}(a),function(a){a.data=b.makeClass("gg.data"),a.data.fetch=function(b,c){d3.text(b,function(d){var e=null;if(b.substr(-4)==".csv")e=a.data(d);else{var f=JSON.parse(d);e=a.data(f)}c(e)})},a.data.prototype.fromObject=function(a,b){var d=function(a,b){if(b&&b.length){var d=_.map(b,function(b){var c=a[b];return c?c.length:0});return d.sort(function(a){return-a}),_.first(d)!==_.last(d)&&c.warn("Not every column contains same # of data."),d[0]}return 0};b=b?b:_.keys(a);var e=d(a,b),f=[];for(var g=0;g<e;g++){var h={};for(var i=0;i<b.length;i++){var j=b[i];h[j]=a[j][g]}f.push(h)}this._internal=f,this._keys=b},a.data.prototype.fromArray=function(a,b){if(a.length===0){this._internal=[],b=b?b:[],this._keys=b;return}b=b?b:_.keys(a[0]),this._internal=a,this._keys=b},a.data.prototype.fromGrid=function(a,b){if(a.length===0){this._internal=[],b=b?b:[],this._keys=b;return}b=b?b:_.keys(a[0]);var c=b.length;this._internal=_.map(a,function(a){var d={};for(var e=0;e<c;e++)d[b[e]]=a[e];return d}),this._keys=b},a.data.prototype.fromCSV=function(a,b){this._internal=d3.csv.parse(a),this._keys=_.keys(this._internal[0]);for(var c=0;c<this._internal.length;c++){var d=this._internal[c];_.each(this._keys,function(a){var b=parseFloat(d[a]);b==d[a]&&(d[a]=b)})}},a.data.prototype.constructData=function(a,b){_.isArray(a)?a.length>0&&_.isArray(a[0])?this.fromGrid(a,b):this.fromArray(a,b):_.isString(a)?this.fromCSV(a,b):this.fromObject(a,b)},a.data.prototype.init=function(a,b){this._internal=null,this._keys=null,a?this.constructData(a,b):(this._internal=[],this._keys=[])},a.data.prototype.len=function(){return this._internal.length},a.data.prototype.get=function(a,b){return arguments.length>=2?this._internal[b][a]:_.pluck(this._internal,a)},a.data.prototype.getObject=function(a){var b,c,d={};for(b=0;b<this._keys.length;b++)c=this._keys[b],d[c]=this.get(c,a);return d},a.data.prototype.rawObject=function(a){return this._internal[a]},a.data.prototype.getObjects=function(){var a=[];for(var b=0;b<this.len();b++)a.push(this.getObject(b));return a},a.data.prototype.rawObjects=function(){return this._internal},a.data.prototype.push=function(a){var b,d;for(b=0;b<this._keys.length;b++)d=this._keys[b],_.has(a,d)||c
.warn("Missing key:",d);return this._internal.push(a),this},a.data.prototype.indices=function(){return _.range(this.len())},a.data.prototype.keys=function(){return this._keys},a.data.prototype.type=function(a){var b=[],c=Math.min(20,this.len());for(var d=0;d<c;d++)b[d]=this._internal[d][a];return _.all(b,_.isNumber)?"continuous":"discrete"},a.data.prototype.levels=function(a,b){var c=_.chain(this._internal).pluck(a).reject(_.isUndefined).uniq().value();return b&&(c=c.sort()),c},a.data.prototype.min=function(a){var b=_.isNumber,c=_.min;return this.query(a,c,b)},a.data.prototype.max=function(a){var b=_.isNumber,c=_.max;return this.query(a,c,b)},a.data.prototype.filter=function(b){var c=[];return _.each(this._internal,function(a){b(a)&&c.push(a)}),a.data(c,this._keys)},a.data.prototype.query=function(a,b,c){return b(_.filter(this.get(a),c))},a.data.prototype.log=function(){c.log()}}(a),function(a){a.facet.grid=b.makeClass("gg.facet.grid",a.facet.base),a.facet.grid.prototype.init=function(b,c){a.facet.base.prototype.init.call(this),this._xvar=b,this._yvar=c,this._xlevels=null,this._ylevels=null},a.facet.grid.prototype.x=function(a){return arguments.length===0?this._xvar:(this._xvar=a,this)},a.facet.grid.prototype.y=function(a){return arguments.length===0?this._yvar:(this._yvar=a,this)},a.facet.grid.prototype.xlevels=function(){if(!this._xlevels){if(!this._xvar||!this._graph)return[];this._xlevels=this._graph.dataLevels(this._xvar)}return this._xlevels},a.facet.grid.prototype.ylevels=function(){if(!this._ylevels){if(!this._yvar||!this._graph)return[];this._ylevels=this._graph.dataLevels(this._yvar)}return this._ylevels},a.facet.grid.prototype.ncol=function(){return Math.max(1,this.xlevels().length)},a.facet.grid.prototype.nrow=function(){return Math.max(1,this.ylevels().length)},a.facet.grid.prototype.bin=function(a){var b=this.xlevels(),c=this.ylevels(),d=_.indexOf(b,a[this.x()]),e=_.indexOf(c,a[this.y()]);return e*this.ncol()+d},a.facet.grid.prototype.renderLabel=function(a,b,c){var d="";this._xvar&&this._yvar?d=this.xlevels()[c]+" | "+this.ylevels()[b]:this._xvar?d=this.xlevels()[c]:this._yvar&&(d=this.ylevels()[c]),a.append("text").attr("font-size",12).attr("font-weight","bold").attr("text-anchor","center").text(d)}}(a),function(a){a.facet.wrap=b.makeClass("gg.facet.wrap",a.facet.base),a.facet.wrap.prototype.init=function(b){a.facet.base.prototype.init.call(this),this._xvar=b,this._col=3,this._row=2,this._levels=null},a.facet.wrap.prototype.x=function(a){return this._xvar=a,this},a.facet.wrap.prototype.levels=function(){if(!this._levels){if(!this._xvar||!this._graph)return[];this._levels=this._graph.dataLevels(this._xvar)}return this._levels},a.facet.wrap.prototype.sanity=function(){var a=this.levels();return a.length>0&&a.length<this._col?this.ncol(a.length):this.ncol(this._col),this},a.facet.wrap.prototype.ncol=function(a){if(!a)return this.sanity(),this._col;this._col=a;var b=this.levels();return b.length>0&&(this._row=Math.max(1,Math.ceil(b.length/a))),this},a.facet.wrap.prototype.nrow=function(a){if(!a)return this.sanity(),this._row;this._row=a;var b=this.levels();return b&&(this._col=Math.max(1,Math.ceil(b.length/a))),this},a.facet.wrap.prototype.bin=function(a){var b=this.levels(),c=_.indexOf(b,a[this._xvar]);return c},a.facet.wrap.prototype.renderLabel=function(a,b,c){var d=b*this._col+c;d<this.levels().length&&a.append("text").attr("font-size",12).attr("font-weight","bold").text(this.levels()[d])}}(a),function(a){a.guide.axis=b.makeClass("gg.guide.axis",a.guide.base),a.guide.axis.prototype.init=function(b,c,d,e){a.guide.base.prototype.init.call(this),this._type=c||b._aes;if(this._type!="x"&&this._type!="y")throw"Axes can only take discrete and continuous scales";this._scale=b,this._flip=e,this._attr={ticks:!0,color:"#000",strokewidth:1,labels:!0,fontsize:11,line:this._type=="x",ticklength:this._type=="x"?3:7}},a.guide.axis.prototype.renderLinear=function(a,b,c){var d=b=="top"||b=="bottom",e=b=="left"||b=="right",f=d?"middle":b=="left"?"end":"start",g=d?0:b=="left"?-10:10,h=e?0:b=="top"?-5:15,i=this.opts("ticklength"),j=this.opts("fontsize"),k=this.opts("color"),l=this.opts("strokewidth");c||(c={});if(!d&&!e)throw"position should be 'top', 'bottom', 'left', or 'right'.";if(d&&this._type!="x")throw"position should be 'top', or 'bottom'.";if(e&&this._type!="y")throw"position should be 'left', or 'right'.";a.attr("class","_debug_axis_"+b);var m=[0,0],n=[0,0];d?m=this._scale.range():n=this._scale.range(),this.opts("line")&&c.line!==!1&&a.append("svg:line").attr("x1",m[0]).attr("x2",m[1]).attr("y1",n[0]).attr("y2",n[1]).attr("stroke",k).attr("stroke-width",l);var o=this._scale.ticks();if(this._flip){var p=_.max(this._scale.range());_.each(o,function(a){a.pos=p-a.pos})}this.opts("ticks")&&c.ticks!==!1&&a.selectAll("labeltick").data(o).enter().append("svg:line").attr("class","labeltick").attr("x1",function(a){return d?a.pos:0}).attr("x2",function(a){return d?a.pos:b=="left"?-i:i}).attr("y1",function(a){return e?a.pos:0}).attr("y2",function(a){return e?a.pos:b=="top"?-i:i}).attr("stroke",k).attr("stroke-width",l),this.opts("labels")&&c.labels!==!1&&a.selectAll("labeltext").data(o).enter().append("svg:text").attr("class","labeltext").attr("x",function(a){return d?a.pos:g}).attr("y",function(a){return e?a.pos+j/4:h}).text(function(a){return a.label}).attr("font-size",j).attr("text-anchor",f).attr("font-color",k)},a.guide.axis.prototype.renderCircular=function(a,b){}}(a),function(a){a.guide.grid=b.makeClass("gg.guide.grid",a.guide.base),a.guide.grid.prototype.init=function(b,c,d){a.guide.base.prototype.init.call(this),this._xscale=b,this._yscale=c,this._coord=d,this._attr={dasharray:"4,5",dashoffset:5,stroke:"#CCC",strokewidth:1,"render-vertical":!1,"render-horizontal":!0}},a.guide.grid.prototype.render=function(a){var c=this,d=this._coord,e=this._xscale,f=e.range(),g=_.min(f),h=_.max(f),i=e.ticks(),j=this._yscale,k=j.range(),l=_.min(k),m=_.max(k),n=j.ticks(),o=function(a){return a.data};this.opts("render-vertical")&&a.selectAll(".vlines").data(i).call(d.vline().attr("x",function(a){return e.apply(a.data)}).attr("y1",b.constfunc(l)).attr("y2",b.constfunc(m)).attr("stroke",this.opts("stroke")).attr("stroke-width",this.opts("strokewidth")).attr("stroke-dasharray",this.opts("dasharray"))),this.opts("render-horizontal")&&a.selectAll(".hlines").data(n).call(d.hline().attr("y",function(a){return j.apply(a.data)}).attr("x1",b.constfunc(g)).attr("x2",b.constfunc(h)).attr("stroke",this.opts("stroke")).attr("stroke-width",this.opts("strokewidth")).attr("stroke-dasharray",this.opts("dasharray")).attr("stroke-dashoffset",this.opts("dashoffset")))}}(a),function(a){a.guide.legend=b.makeClass("gg.guide.legend",a.guide.base),a.guide.legend.prototype.init=function(b,c,d){a.guide.base.prototype.init.call(this);var e=["x","y","text"];this._graph=b,this._layers=c,this._scales=d,this._coord=a.coord.cart(),this._aes=_.chain(d).keys().reject(function(a){return a.indexOf("_")!=-1||e.indexOf(a)!=-1}).value(),this._mappings=_.map(c,function(a){return a.getMap()}),this._legends=null},a.guide.legend.prototype.group=function(){this._legends=[];var a=_.clone(this._aes);while(a.length>0){var b=[],c=a.pop(),d=_.pluck(this._mappings,c),e=null;b.push(c);var f=0;while(f<a.length)e=_.pluck(this._mappings,a[f]),_.isEqual(e,d)?b.push(a.splice(f,1)[0]):f++;this._legends.push(b)}return this},a.guide.legend.prototype.render=function(a,c){_.isNull(this._legends)&&this.group();var d=this,e=10;_.each(this._legends,function(c){var f=a.append("svg:g").attr("transform",b.translate(0,e));e+=10+d._renderEach(f,c,null)})},a.guide.legend.prototype._renderEach=function(c,d,e){var f=this,g=d[0],h=this._scales[g];if(h.type()=="continuous")for(var i=1;i<d.length;i++)if(this._scales[d[i]].type()=="discrete"){g=d[i],h=this._scales[d[i]];break}var j=[],k=[];for(var i=0;i<this._layers.length;i++)this._mappings[i][g]&&(k.push(this._layers[i]),j.push(this._layers[i]._cls_name.split(".")[2]));j=_.uniq(j);var l={color:b.constfunc("#000000"),stroke:b.constfunc("#000000"),strokewidth:b.constfunc(0),symbol:b.constfunc(a.symbol.DIAMOND),radius:b.constfunc(5),opacity:b.constfunc(1)};if(j.length==1){if(j[0]=="point")l.symbol=b.constfunc(a.symbol.CIRCLE);else if(j[0]=="line"||j[0]=="path")l.symbol=b.constfunc(a.symbol.CROSS),l.strokewidth=b.constfunc(1);_.each(_.keys(l),function(a){if(a!="radius"){var c=k[0].opts(a);if(_.isString(c)||_.isNumber(c))l[a]=b.constfunc(c)}})}_.each(d,function(a){l[a]=_.bind(f._scales[a].apply,f._scales[a],"data")});var m=h.type()=="discrete"?this._graph.levels(g).length:5,n=h.ticks(m);c.append("text").attr("x",0).attr("y",0).style("font-size","13px").style("font-weight","bold").text(f._graph._varlabel(g));var o=this._coord;return j[0]=="line"||j[0]=="path"?c.selectAll(".LegendBox").data(n).enter().append("svg:line").attr("x1",b.constfunc(0)).attr("x2",b.constfunc(13)).attr("y1",function(a,b){return b*18+13}).attr("y2",function(a,b){return b*18+13}).attr("symbol",l.symbol).attr("fill",l.color).attr("stroke",l.stroke).attr("fill-opacity",l.opacity).attr("stroke-width",l.strokewidth):c.selectAll(".LegendBox").data(n).call(o.point().attr("x",b.constfunc(5)).attr("y",function(a,b){return b*18+13}).attr("r",l.radius).attr("symbol",l.symbol).attr("fill",l.color).attr("stroke",l.stroke).attr("fill-opacity",l.opacity).attr("stroke-width",l.strokewidth)),c.selectAll(".LegendText").data(n).enter().append("text").style("font-size","12px").attr("x",20).attr("y",function(a,b){return 17+b*18}).text(function(a){return String(a.label)}),14+n.length*18}}(a),function(a){a.layer.area=b.makeClass("gg.layer.area",a.layer.base),a.layer.area.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("stroke","none").opts("opacity",.4).opts("color","steelblue").opts("strokewidth",0).opts("padding",.5)},a.layer.area.prototype.render=function(a){var b=a.coord,c=a.cell,d=a.scales,e=a.rawScales.y.min(),f=d.y(e),g=function(a,b){var c=a.length;a.push(a[a.length-1]),a.push(a[0]),b.push(f),b.push(f)},h,i;h=d.x,d.y_stack?i=d.y_stack:i=d.y,_.each(a.computedData,function(a,e){var f="_debug_area_"+e;c.selectAll("."+f).data([a]).call(b.poly("svg:polygon").attr("x",h).attr("y",i).attr("sort",h).attr("postprocess",g).attr("class",f).style(d))})},a.layer.area.prototype.imputeMapping=function(b,c){var d=a.layer.base.prototype.imputeMapping.call(this,b,c);return!_.has(c,"group")&&_.has(c,"stroke")?d.group=c.stroke:!_.has(c,"group")&&_.has(c,"color")?d.group=c.color:delete d.group,d}}(a),function(a){var a=a||{};a.layer=a.layer||{},a.layer.bar=b.makeClass("gg.layer.bar",a.layer.base),a.layer.bar.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=0;c.assert(0<=b,"padding should be nonnegative."),c.assert(b<.5,"padding should be < 0.5"),this.opts("padding",b).opts("strokewidth",0)},a.layer.bar.prototype.defaultMin=function(a){if(a=="y")return 0},a.layer.bar.prototype.defaultScales=function(){return{x:a.scale.discrete("x")}},a.layer.bar.prototype.render=function(a){var d=a.coord,e=a.cell,f=a.scales,g=a.rawScales.x.width(),h=g/2*(1-this.opts("padding")*2),i=a.rawScales.y.min();c.assert(_.isNumber(i),"originLocation is numeric.");var j=f.y(i),k=null,l=null,m=b.add(f.x,h),n=b.sub(f.x,h),o=null;f.y_stack?(l=f.y_stack,o=b.sub(j,f.y),k=b.add(l,o)):(l=f.y,k=j),_.each(a.computedData,function(a,b){var c=a.rawObjects(),g="_debug_bar_"+b;e.selectAll("."+g).data(c).call(d.rect().attr("x1",n).attr("x2",m).attr("y1",l).attr("y2",k).style(f).attr("class",g))})}}(a),function(a){a.layer.box=b.makeClass("gg.layer.box",a.layer.base),a.layer.box.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=0;c.assert(0<=b,"padding should be nonnegative."),c.assert(b<.5,"padding should be < 0.5"),this.opts("padding",b).opts("strokewidth",0),this._default_stats=a.stats.box},a.layer.box.prototype.defaultMin=function(a){if(a=="y")return 0},a.layer.box.prototype.render=function(a){var c=a.coord,d=a.cell,e=a.scales,f=a.rawScales.x.width(),g=f/2*(1-this.opts("padding")*2);_.each(a.computedData,function(a,f){var h;h="_debug_box_rect_"+f,d.selectAll("."+h).data(a.rawObjects()).call(c.rect().attr("x1",b.sub(e.x,g)).attr("x2",b.add(e.x,g)).attr("y1",e.y_q1).attr("y2",e.y_q3).attr("class",h).style(e)),h="_debug_bar_a_"+f,d.selectAll("."+h).data(a.rawObjects()).call(c.hline().attr("x1",b.sub(e.x,g)).attr("x2",b.add(e.x,g)).attr("y",e.y_q4).attr("class",h).style(e)),h="_debug_bar_b_"+f,d.selectAll("."+h).data(a.rawObjects()).call(c.hline().attr("x1",b.sub(e.x,g)).attr("x2",b.add(e.x,g)).attr("y",e.y_q0).attr("class",h).style(e)),h="_debug_bar_c_"+f,d.selectAll("."+h).data(a.rawObjects()).call(c.hline().attr("x1",b.sub(e.x,g)).attr("x2",b.add(e.x,g)).attr("y",e.y_q2).attr("class",h).style(e)),h="_debug_bar_d_"+f,d.selectAll("."+h).data(a.rawObjects()).call(c.vline().attr("x",e.x).attr("y1",e.y_q4).attr("y2",e.y_q3).attr("class",h).style(e)),h="_debug_bar_e_"+f,d.selectAll("."+h).data(a.rawObjects()).call(c.vline().attr("x",e.x).attr("y1",e.y_q0).attr("y2",e.y_q1).attr("class",h).style(e))})}}(a),function(a){a.layer.line=b.makeClass("gg.layer.line",a.layer.base),a.layer.line.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("color","red").opts("strokewidth",2).opts("padding",.5)},a.layer.line.prototype.render=function(a){var c=a.coord,d=a.cell,e=a.scales;_.each(a.computedData,function(a,f){var g="_debug_path_"+f;d.selectAll("."+g).data([a]).call(c.poly("svg:polyline").attr("x",e.x).attr("y",e.y).attr("sort",e.x).attr("stroke",e.color).attr("stroke-width",e.strokewidth).attr("fill",b.constfunc("none")).attr("class",g))})},a.layer.line.prototype.imputeMapping=function(b,c){var d=a.layer.base.prototype.imputeMapping.call(this,b,c);return delete d.group,!_.has(c,"group")&&_.has(c,"stroke")?d.group=c.stroke:!_.has(c,"group")&&_.has(c,"color")&&(d.group=c.color),d}}(a),function(a){a.layer.path=b.makeClass("gg.layer.path",a.layer.base),a.layer.path.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("stroke","red").opts("color","red").opts("strokewidth",2)},a.layer.path.prototype.render=function(a){var c=a.coord,d=a.cell,e=a.scales;_.each(a.computedData,function(a,f){var g="_debug_path_"+f;d.selectAll("."+g).data([a]).call(c.poly("svg:polyline").attr("x",e.x).attr("y",e.y).attr("stroke",e.color).attr("stroke-width",e.strokewidth).attr("fill",b.constfunc("none")).attr("class",g))})},a.layer.path.prototype.imputeMapping=function(b,c){var d=a.layer.base.prototype.imputeMapping.call(this,b,c);return delete d.group,!_.has(c,"group")&&_.has(c,"stroke")?d.group=c.stroke:!_.has(c,"group")&&_.has(c,"color")&&(d.group=c.color),d}}(a),function(a){a.layer.point=b.makeClass("gg.layer.point",a.layer.base),a.layer.point.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("radius",3),this.opts("symbol",a.symbol.CIRCLE)},a.layer.point.prototype.render=function(a){var b=a.coord,c=a.cell,d=a.scales;_.each(a.computedData,function(a,e){var f=a.rawObjects(),g="_debug_point_"+e;c.selectAll("."+g).data(f).call(b.point().attr("x",d.x).attr("y",d.y).attr("r",d.radius).attr("stroke",d.stroke).attr("stroke-width",d.strokewidth).attr("fill-opacity",d.opacity).attr("fill",d.color).attr("symbol",d.symbol).attr("class",g))})},a.layer.point.prototype.imputeMapping=function(b,c){var d=a.layer.base.prototype.imputeMapping.call(this,b,c);return d.group&&delete d.group,d}}(a),function(a){a.layer.text=b.makeClass("gg.layer.text",a.layer.base),a.layer.text.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("opacity",1).opts("fill","black").opts("font","Verdana")},a.layer.text.prototype.render=function(a){var b=a.coord,c=a.cell,d=a.scales;_.each(a.computedData,function(a,e){var f=a.rawObjects(),g="_debug_text_"+e;c.selectAll("."+g).data(f).call(b.text().attr("x",d.x).attr("y",d.y).attr("text",d.text).attr("font-size",d.fontsize).attr("fill",d.color).attr("fill-opacity",d.opacity).attr("font-family",d.font).attr("class",g))})}}(a),function(a){a.layer.tile=b.makeClass("gg.layer.tile",a.layer.base),a.layer.tile.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("stroke","none").opts("opacity",.4).opts("color","green").opts("strokewidth",0).opts("padding",.5)},a.layer.base.prototype.requiredMap=function(){return["x","y"]},a.layer.tile.prototype.render=function(a){var c=a.coord,d=a.cell,e=a.scales,f=a.rawScales.x.width(),g=a.rawScales.y.width(),h=f/2,i=g/2;_.each(a.computedData,function(a,f){var g=a.rawObjects(),j="_debug_tile_"+f;d.selectAll("."+j).data(g).call(c.rect().attr("x1",b.sub(e.x,h)).attr("y1",b.sub(e.y,i)).attr("x2",b.add(e.x,h)).attr("y2",b.add(e.y,i)).attr("class",j).style(e))})}}(a),function(a){a.scale.continuous=b.makeClass("gg.scale.continuous",a.scale.base),a.scale.continuous.prototype.init=function(b,c,d){a.scale.base.prototype.init.call(this),this._type="continuous",this._d3scale=null,this._min=_.isNumber(c)?c:null,this._max=_.isNumber(d)?d:null,this._useDefault=!1,this._defaultMin=null,this._defaultMax=null,this.opts("transform",b||"linear").opts("expand",0),this.opts("transform")==="log"&&(this._absoluteMin=1)},a.scale.continuous.prototype.domain=function(a){return arguments.length===1?(this._min=a[0],this._max=a[1],this):[this._min,this._max]},a.scale.continuous.prototype.width=function(){return 10},a.scale.continuous.prototype._makeDomain=function(){var a=this._aes,b=this._graph.min(a),d=this._graph.max(a);this._defaultMin=this._graph.defaultMin(a),this._defaultMax=this._graph.defaultMax(a),_.isNumber(this._defaultMin)&&this._defaultMin<this._absoluteMin&&(this._defaultMin=this._absoluteMin),_.isNumber(this._defaultMax)&&this._defaultMax<this._absoluteMax&&(this._defaultMax=this._absoluteMax);var e=_.chain([b,this._min,this._defaultMin]).filter(_.isNumber).min().value(),f=_.chain([d,this._max,this._defaultMax]).filter(_.isNumber).max().value();return c.assert(this._saneNumber(e),"_min is not invalid.",e),c.assert(this._saneNumber(f),"_max is not invalid.",f),this.min(e),this.max(f),[this.min(),this.max()]},a.scale.continuous.prototype.make=function(){c.assert(this._range,"range is required."),this._d3scale=this.opts("transform")=="log"?d3.scale.log():d3.scale.linear();var a=_.isNumber(this._min)&&_.isNumber(this._max)?[this._min,this._max]:this._makeDomain();if(this.opts("expand")>0&&this.opts("transform")=="linear"){var b=(_.max(a)-_.min(a))*this.opts("expand"),d=0,e=1;a[0]>a[1]&&(d=1,e=0),!_.isNumber(this._defaultMin)&&this._min!==0&&(a[d]-=b),_.isNumber(this._defaultMax)||(a[e]+=b)}this._d3scale.domain(a).range(this._range)},a.scale.continuous.prototype._apply=function(a){return this._d3scale||this.make(),this._d3scale(a)},a.scale.base.prototype.ticks=function(a){var c=0,d=this._min,e=this._max,a=this._getNumticks(a);this.opts("transform")=="log"&&(d=Math.max(Math.log(d)/Math.LN10,0),e=Math.log(e)/Math.LN10,c=Math.pow(10,-7));var f=e-d,g=Math.pow(10,Math.floor(Math.log(f/a)/Math.LN10)),h=a/f*g;h<=.15?g*=10:h<=.35?g*=5:h<=.75&&(g*=2);var i=[],j=Math.ceil(d/g)*g,k=-Math.floor(Math.log(g)/Math.LN10);while(j<=e+c){var l=j,m=l;if(this.opts("transform")=="log"){l%1>c&&(l=Math.floor(l)+Math.log(10*(l%1))/Math.LN10),l=Math.exp(l*Math.LN10);if(l>this._max+c)break;m=b.prettify(l)}else m=b.prettify(l,k);i.push(this._tickObject(l,this.apply(l),m)),j+=g}return i}}(a),function(a){a.scale.discrete=b.makeClass("gg.scale.discrete",a.scale.base),a.scale.discrete.prototype.init=function(){a.scale.base.prototype.init.call(this),this._type="discrete",this._levels=null,this._eachWidth=null,this._padding=.02},a.scale.discrete.prototype.domain=function(a){return arguments.length===0?this._levels:(this._levels=a,this)},a.scale.discrete.prototype.padding=function(a){return arguments.length===0?this._padding:(this._padding=a,this)},a.scale.discrete.prototype.width=function(){return this._eachWidth||this.make(),this._eachWidth},a.scale.discrete.prototype.make=function(a){c.assert(this._range,"range is required.");var b=Math.abs(this._range[1]-this._range[0]);this._levels=this._graph.levels(this._aes),this._eachWidth=b/this._levels.length,this._eachWidth=Math.abs(this._eachWidth);var d=this._padding>=1?this._padding:this._eachWidth*this._padding;return this._eachWidth-=d,this._padding=d,this},a.scale.discrete.prototype._apply=function(a){this._levels||this.make();var b=_.indexOf(this._levels,a);if(b===-1)throw"Discrete Scale got an input that is not in the range";return b*(this._eachWidth+this._padding)+this._padding/2+this._eachWidth/2},a.scale.discrete.prototype.ticks=function(a){var a=this._getNumticks(a),b=Math.max(1,Math.round(this._levels.length/a)),c=Math.floor(b/2),d=[];for(var e=c;e<this._levels.length;e+=b)d.push(this._tickObject(this._levels[e],this.apply(this._levels[e]),this._levels[e]));return d}}(a),function(a){a.scale.gradient=b.makeClass("gg.scale.gradient",a.scale.continuous),a.scale.gradient.prototype.init=function(b,c){a.scale.continuous.prototype.init.call(this),this._low=b||"#cccccc",this._high=c||"steelblue",this._range=[this._low,this._high],this._d3scale=null},a.scale.gradient.prototype.make=function(){return c.assert(this._range,"range is required."),this._min=this._graph.min(this._aes),this._max=this._graph.max(this._aes),this._d3scale=d3.scale.linear().domain([this._min,this._max]).range(this._range),this},a.scale.gradient.prototype._apply=function(a){return this._d3scale||this.make(),this._d3scale(a)}}(a),function(a){a.scale.id=b.makeClass("gg.scale.id",a.scale.base),a.scale.id.prototype.init=function(){a.scale.base.prototype.init.call(this),this._type=null},a.scale.id.prototype.type=function(){return this._type||(this._type=this._graph.type(this._aes)),this._type},a.scale.id.prototype.domain=function(){return this._type=="continuous"?[this._graph.min(this._aes),this._graph.max(this._aes)]:this._graph.levels(this._aes)},a.scale.id.prototype.range=function(){return this.domain()},a.scale.id.prototype.make=function(){},a.scale.id.prototype._apply=function(a){return a}}(a),function(a){a.scale.palette=b.makeClass("gg.scale.palette",a.scale.discrete),a.scale.palette.prototype.init=function(b){a.scale.discrete.prototype.init.call(this),this._paletteName=b,this._d3scale=null},a.scale.palette.prototype.make=function(){this._levels=this._graph.levels(this._aes);var a=this._levels.length;if(this._paletteName&&!1)this._d3scale=d3.scale.ordinal().domain(this._levels).range(colorbrewer[this.paletteName][a]);else if(a<=10)this._d3scale=d3.scale.category10();else{if(!(a<=20))throw"Too many values. Need to handle this case later...";this._d3scale=d3.scale.category20()}return this},a.scale.palette.prototype._apply=function(a){return this._d3scale||this.make(),this._d3scale(a)}}(a),function(a){a.scale.symbol=b.makeClass("gg.scale.symbol",a.scale.discrete),a.scale.symbol.prototype.init=function(b){a.scale.discrete.prototype.init.call(this),this._symbols=[1,2,3,4,5,6,7,8,9],this._numSymbols=this._symbols.length},a.scale.symbol.prototype.make=function(){return this._levels=this._graph.levels(this._aes),this._numLevels=this._levels.length,this},a.scale.symbol.prototype._apply=function(a){return this._d3scale||this.make(),this._symbols[this._levels.indexOf(a)%this._numSymbols]}}(a),function(a){a.scale.time=b.makeClass("gg.scale.time",a.scale.continuous),a.scale.time.prototype.make=function(){return c.assert(this._range,"range is required."),this.d3scale=d3.time.scale().domain(this._makeDomain()).range(this._range),this}}(a),a.stats.bin=b.makeClass("gg.stats.bin",a.stats.base),a.stats.bin.prototype.compute=function(b){var c=b.getObject(0);return c.$count=b.len(),a.data([c])},a.stats.bin.prototype.imputeMapping=function(){return{y:"$count"}},function(a){a.stats.box=b.makeClass("gg.stats.box",a.stats.base),a.stats.box.prototype.imputeMapping=function(a,b){return{y_q0:"$q0",y_q1:"$q1",y_q2:"$q2",y_q3:"$q3",y_q4:"$q4"}},a.stats.box.prototype.requiredMap=function(){return["x","y"]},a.stats.box.prototype.compute=function(c,d){var e=c.getObject(0),f=d.y,g=c.get(f),h=g.length,i=_.sortBy(g,b.identity),j=i[0],k=i[h-1],l=h/4,m=h/2,n=h/4*3,o=(i[Math.ceil(l)]+i[Math.floor(l)])/2,p=(i[Math.ceil(m)]+i[Math.floor(m)])/2,q=(i[Math.ceil(n)]+i[Math.floor(n)])/2;return e.$q0=j,e.$q1=o,e.$q2=p,e.$q3=q,e.$q4=k,a.data([e])}}(a),a.stats.count=a.stats.bin,a.stats.id=b.makeClass("gg.stats.id",a.stats.base),function(a){a.stats.path=b.makeClass("gg.stats.path",a.stats.base),a.stats.path.prototype.compute=function(b,d){var e=d.x,f=d.y;c.assert(e),c.assert(f);var g=b.getObject(0),h=g[e],i=g[f],j=[],k=b.len();for(var l=1;l<k;l++)g=b.getObject(l),g.prevX=h,g.prevY=i,h=g[e],i=g[f],j.push(g);return a.data(j)}}(a),function(a){a.stats.stack=b.makeClass("gg.stats.stack",a.stats.base),a.stats.stack.prototype.requiredMap=function(){return["y","group"]},a.stats.stack.prototype.compute=function(b,d){var e=d.y;c.assert(e,"y mapping is required.");var f=[],g=b.len(),h=0;for(var i=0;i<g;i++){var j=b.getObject(i);h+=j[e],j.$partial=h,f[i]=j}return a.data(f)},a.stats.stack.prototype.imputeMapping=function(a,b){var c={y_stack:"$partial"};return c}}(a),function(a){a.stats.stackother=b.makeClass("gg.stats.stackother",a.stats.base),a.stats.stackother.prototype.requiredMap=function(){return["y","group"]},a.stats.stackother.prototype.compute=function(a,b){return a},a.stats.stackother.prototype.defaultMap=function(a,b){var c={y_stack:"$partial"};return c},a.stats.stackother.prototype.postProcess=function(a,b){var c=a[0].len();for(var d=0;d<c;d++){var e=0;for(var f=0;f<a.length;f++){var g=a[f].rawObject(d);e+=g[b.y],g.$partial=e}}return a}}(a),function(a){a.symbol=a.symbol||{};var b={},c=Math.sqrt(2),d=0,e=Math.sqrt(3)/2,f=Math.sqrt(3)/2,g=0,h=-Math.sqrt(3)/2,i=-Math.sqrt(3)/2,j=1,k=.5,l=-0.5,m=-1,n=-0.5,o=.5,p=(Math.sqrt(5)-1)/4,q=function(a){return Math.cos(Math.PI/180*36*a)},r=function(a){return Math.sin(Math.PI/180*36*a)},s=q(1),t=q(2),u=q(3),v=q(4),w=q(5),x=q(6),y=q(7),z=q(8),A=q(9),B=r(1),C=r(2),D=r(3),E=r(4),F=r(5),G=r(6),H=r(7),I=r(8),J=r(9),K=1,L=2,M=3,N=4,O=5,P=6,Q=7,R=8,S=9;a.symbol.appendSymbol=function(a,c){var d=null;return _.isFunction(c)?d=function(a,d){var e=c(a,d),f=b[e];return this.appendChild(document.createElementNS(f.space,f.local))}:d=function(){var a=b[c];return this.appendChild(document.createElementNS(a.space,a.local))},a.select(d)},a.symbol.makeAdditionalAttr=function(a){var b=a._attrs,q=function(a,c,d){var e=b[d];return _.isFunction(e)?e(a,c):e},r={};return r.cy=function(a,b){var c=q(a,b,"symbol");if(c==K)return q(a,b,"y")},r.cx=function(a,b){var c=q(a,b,"symbol");if(c==K)return q(a,b,"x")},r.r=function(a,b){var c=q(a,b,"symbol");if(c==K)return q(a,b,"r")},r.points=function(a,b){var r=q(a,b,"symbol"),K=q(a,b,"x"),T=q(a,b,"y"),U=q(a,b,"r"),V;if(r==L)return[K+U,T+U,K-U,T+U,K-U,T-U,K+U,T-U].join(",");if(r==M)return[K+U,T,K,T+U,K-U,T,K,T-U].join(",");if(r==N)return[K+U*d,T+U*j,K+U*e,T+U*k,K+U*f,T+U*l,K+U*g,T+U*m,K+U*h,T+U*n,K+U*i,T+U*o].join(",");if(r==P)return[K+U*d,T+U*j,K+U*f,T+U*l,K+U*h,T+U*n].join(",");if(r==O)return[K+U*e,T+U*k,K+U*g,T+U*m,K+U*i,T+U*o].join(",");if(r==Q)return V=U*p,[K+V*d,T+V*j,K+U*B,T+U*s,K+V*C,T+V*t,K+U*D,T+U*u,K+V*E,T+V*v,K+U*F,T+U*w,K+V*G,T+V*x,K+U*H,T+U*y,K+V*I,T+V*z,K+U*J,T+U*A].join(",");if(r==R)return[K+U,T,K,T,K,T+U,K,T,K-U,T,K,T,K,T-U,K,T].join(",");if(r==S)return V=U*c/2,[K+V,T+V,K,T,K+V,T-V,K,T,K-V,T+V,K,T,K-V,T-V,K,T].join(",")},r},b[K]="svg:circle",b[L]="svg:polygon",b[M]="svg:polygon",b[N]="svg:polygon",b[O]="svg:polygon",b[P]="svg:polygon",b[Q]="svg:polygon",b[R]="svg:polyline",b[S]="svg:polyline",a.symbol.CIRCLE=K,a.symbol.BOX=L,a.symbol.DIAMOND=M,a.symbol.HEX=N,a.symbol.TRIANGLE=O,a.symbol.TRIANGLE_REVERSE=P,a.symbol.STAR=Q,a.symbol.CROSS=R,a.symbol.X=S,_.each(b,function(a,c){b[c]=d3.ns.qualify(a)})}(a);var d=function(a,b){b=b||{};var d=function(a,d){c.assert(a);var e=d.length;for(var f=0;f<e;f++){var g=d[f];b[g]?c.log(g,"is already set."):(c.assert(a[g]),b[g]=a[g])}};return d(a.coord,["cart","polar"]),d(a.facet,["grid","wrap"]),d(a.guide,["axis","grid","legend"]),d(a.layer,["area","bar","box","line","path","point","text","tile"]),d(a.scale,["continuous","discrete","gradient","id","palette","symbol","time"]),d(a.stats,["bin","box","id","path","stack","stackother"]),b};return d(a,a),a}();